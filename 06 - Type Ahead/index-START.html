<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/ðŸ”¥" />
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>

  <script>


    async function fetchData(url) {
      try {
        const response = await fetch(url);

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log(data);

        return data;
      } catch (error) {
        console.error('Error:', error.message);
        // Handle the error or provide fallback data
        return null;
      }
    }

    const citiesData = [];
    // const url = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    const url = './cities.json';

    // Fetch data only once
    async function getData() {
      try {
        const data = await fetchData(url);
        citiesData.push(...data);
      } catch (error) {
        console.error('Error fetching data:', error.message);
        // Handle the error or provide fallback data
      }
    }


    // Function to filter cities based on search term
    function filterCities(cities, searchItem) {
      const regex = new RegExp(searchItem, 'gi');
      const filteredCities = cities.filter((obj) => obj.state.match(regex) || obj.city.match(regex))
      const defaultMessage = [{ city: "no match city", state: "no match state", population: "/" }]
      return !filteredCities.length ? defaultMessage : filteredCities
    }
    // function filterCitiesTwo(cities, searchItem) {
    //   return cities.filter(function (obj) {
    //     return obj.city.toLowerCase().includes(searchItem.toLowerCase()) || obj.state.toLowerCase().includes(searchItem.toLowerCase());
    //   });
    // }

    // Function to test the performance of the first method : filterCities()
    // function testMethodOne(citiesData, searchItem) {

    //   const startTime = performance.now();
    //   const result = filterCities(citiesData, searchItem);
    //   const endTime = performance.now();
    //   const executionTime = (endTime - startTime).toFixed(3); // Display 3 decimal places

    //   console.log('Method One - Result:', result);
    //   console.log('Method One - Execution Time:', executionTime,"ms");
    // }

    // Function to test the performance of the second method : filterCitiesTwo()
    // function testMethodTwo(citiesData, searchItem) {

    //   const startTime = performance.now();
    //   const result = filterCitiesTwo(citiesData, searchItem);
    //   const endTime = performance.now();
    //   const executionTime = (endTime - startTime).toFixed(3); // Display 3 decimal places

    //   console.log('Method Two - Result:', result);
    //   console.log('Method Two - Execution Time:', executionTime,"ms");
    // }




    // Function to display filtered cities
    // function displayCities(matchedCitiesArray) {

    //   const hlgtWord = new RegExp(searchItem, 'gi');
    //   suggestionsList.innerHTML = matchedCitiesArray
    //     .map((obj) => `
    //   <li>
    //     <span class="name">${obj.city}, ${obj.state}</span>
    //     <span class="population">${obj.population}</span>
    //   </li>
    // `)
    //     .join('');
    // }


    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function displayCities(matchedCitiesArray, searchTerm) {
      const html = matchedCitiesArray.map(obj => {
        const regex = new RegExp(searchTerm, 'gi');
        const cityName = obj.city.replace(regex, `<span class="hl">${searchTerm}</span>`);
        const stateName = obj.state.replace(regex, `<span class="hl">${searchTerm}</span>`);
        return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>
        <span class="population">${numberWithCommas(obj.population)}</span>
      </li>
    `;
      }).join('');
      suggestionsList.innerHTML = html;
    }

    // Function to handle input changes with debounce
    function debounce(func, delay) {
      let timer;
      return function (...args) {
        clearTimeout(timer);
        timer = setTimeout(() => func.apply(this, args), delay);
      };
    }

    // Handler for input changes
    function handleInput(event) {
      const searchTerm = event.target.value;
      // console.log("Search Term:", searchTerm);

      const matchedCitiesArray = filterCities(citiesData, searchTerm);
      displayCities(matchedCitiesArray, searchTerm);
      // for testing purposes
      // testMethodOne(citiesData, searchTerm);
      // testMethodTwo(citiesData, searchTerm);
    }

    const suggestionsList = document.querySelector('.suggestions');
    const searchInput = document.querySelector('.search');

    // Add the input event listener with debounce (300ms delay)
    searchInput.addEventListener('input', debounce(handleInput, 300));

    // Fetch data once the page loads
    getData();

  </script>
</body>

</html>
